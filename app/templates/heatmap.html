<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js" type="application/javascript"></script>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    <link href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" rel="stylesheet" type="text/css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js" type="application/javascript"></script>
    <script src="static/js/Leaflet.heat/dist/leaflet-heat.js" type="application/javascript"></script>

    <script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.388.js"></script>

        <style>
        #map { width: 100%; height: 100vh; }
        body { font: 16px/1.4 "Helvetica Neue", Arial, sans-serif; }
        .ghbtns { position: relative; top: 4px; margin-left: 5px; }
        a { color: #0077ff; }

        #button-wrapper {
            position: absolute;
            bottom: 10px;
            width: 100%;
        }
    </style>

</head>
<body>
    <div id="map"></div>
    <div id="button-wrapper">
        <input type="button" id="start-btn" value="Start animation" class="btnStyle span3" />
        <h3 id="timestamp"></h3>
    </div>
<script>
    var map = L.map('map').setView([55.618534,12.080729], 15);

var tiles = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
}).addTo(map);


    loads_of_polygons = [[[55.62387352200005, 12.068865842000037], [55.62319385500007, 12.068641263000075], [55.62322936100003, 12.065757671000028], [55.62427928800008, 12.066027166000026], [55.62387352200005, 12.068865842000037]], [[55.62374672000004, 12.069746191000036], [55.622468526000034, 12.069988736000028], [55.62247867100007, 12.068371769000066], [55.62387352200005, 12.068883808000066], [55.62386337800007, 12.068901775000029], [55.62374672000004, 12.069746191000036]], [[55.61896849800007, 12.071830283000054], [55.617725660000076, 12.065290547000075], [55.617745951000074, 12.065308514000037], [55.61775609700004, 12.065326480000067], [55.62067797100008, 12.065658857000074], [55.62177361800008, 12.068335836000074], [55.62157579500007, 12.070312130000048], [55.61896849800007, 12.071830283000054]], [[55.62434522400008, 12.065272581000045], [55.62289459500005, 12.065065968000056], [55.623132989000055, 12.062191360000043], [55.623822801000074, 12.062308141000074], [55.62463432900006, 12.063493917000073], [55.62459882500008, 12.063466967000068], [55.62434522400008, 12.065272581000045]], [[55.62191057200005, 12.060331847000043], [55.62183955900008, 12.063008826000043], [55.61785755500006, 12.062514753000073], [55.61793872100003, 12.059900656000025], [55.62191057200005, 12.060331847000043]], [[55.621748256000046, 12.065604958000051], [55.61812134300004, 12.065254615000072], [55.618238018000056, 12.062640517000034], [55.62182941400005, 12.063044759000036], [55.62182941400005, 12.063071709000042], [55.621748256000046, 12.065604958000051]], [[55.61693935400007, 12.070087551000029], [55.616959646000055, 12.072944194000058], [55.61517898500006, 12.073959290000062], [55.61508766700007, 12.072360289000073], [55.61514854600006, 12.072315373000038], [55.61534640100007, 12.070168399000067], [55.61693935400007, 12.070087551000029]], [[55.618851825000036, 12.077660349000041], [55.617903211000055, 12.077624416000049], [55.61791842900004, 12.076860848000024], [55.61798944900005, 12.076312876000031], [55.61888733500007, 12.076285926000025], [55.61888226200006, 12.076303893000045], [55.618877189000045, 12.076420674000076], [55.618851825000036, 12.077660349000041]], [[55.61567615800004, 12.081253610000033], [55.614976056000046, 12.081163778000075], [55.61498620300006, 12.080696654000064], [55.61542249900003, 12.080463092000059], [55.61545293800003, 12.079331215000025], [55.615067374000034, 12.079223417000037], [55.61498620300006, 12.07886409100007], [55.61498620300006, 12.078118490000065], [55.615529036000055, 12.078145439000025], [55.61551381700008, 12.077318989000048], [55.61700023000003, 12.07739983700003], [55.616995157000076, 12.07739983700003], [55.61685818600006, 12.078648496000028], [55.616589316000045, 12.07974444000007], [55.61639654000004, 12.080247497000073], [55.615995766000026, 12.080984115000035], [55.61591966900005, 12.081109879000053], [55.61567615800004, 12.081253610000033]], [[55.61622405500003, 12.07735492200004], [55.61550874300008, 12.077310006000062], [55.61550874300008, 12.077750180000066], [55.61474775900007, 12.078064591000043], [55.61451946100004, 12.080481059000022], [55.61427086800006, 12.080516991000025], [55.613910660000045, 12.079609693000066], [55.61419984200006, 12.078298153000048], [55.61451438800003, 12.077534585000024], [55.613525080000045, 12.07788492800006], [55.61326126100005, 12.075639139000032], [55.61586893700007, 12.073968273000048], [55.61613781300008, 12.074183869000024], [55.61652336600008, 12.073959290000062], [55.617152419000035, 12.073869458000047], [55.617152419000035, 12.073887425000066], [55.61622405500003, 12.07735492200004]], [[55.61211464000007, 12.07819035500006], [55.60944075300006, 12.077813062000075], [55.61228714300006, 12.076124230000062], [55.61314457100008, 12.07825323700007], [55.61211464000007, 12.07819035500006]], [[55.61128255800003, 12.082511251000028], [55.61069400100007, 12.08291549300003], [55.610430163000046, 12.083086173000027], [55.61019676600006, 12.083409567000047], [55.60948134400007, 12.082816679000075], [55.61080562500007, 12.078217304000077], [55.61082592000008, 12.078064591000043], [55.61125211600006, 12.078172388000041], [55.611368811000034, 12.078262220000056], [55.611176010000065, 12.078926973000023], [55.61161742200005, 12.079322232000038], [55.611637717000065, 12.080130716000042], [55.61191676900006, 12.080615806000026], [55.61190154800005, 12.08091225000004], [55.61169860100006, 12.081460222000032], [55.611531170000035, 12.082062094000037], [55.61128255800003, 12.082511251000028]], [[55.61001918000005, 12.091710000000035], [55.60923271900003, 12.091710000000035], [55.60898916700006, 12.089518111000075], [55.609623415000044, 12.089015054000072], [55.60935956900005, 12.085763153000073], [55.60936971700005, 12.085781119000046], [55.61257126300006, 12.086149428000056], [55.61404764100007, 12.091359657000055], [55.61414910800005, 12.092222040000024], [55.61412881500007, 12.092895776000034], [55.613413465000065, 12.092994591000036], [55.613377951000075, 12.092177124000045], [55.61282494000005, 12.091215926000075], [55.61001918000005, 12.091710000000035]], [[55.616584243000034, 12.092976624000073], [55.61567615800004, 12.093264085000044], [55.61591459600004, 12.089293532000056], [55.61683789400007, 12.089518111000075], [55.616817602000026, 12.089545060000034], [55.616584243000034, 12.092976624000073]], [[55.61786770000003, 12.092446618000054], [55.61665526500008, 12.092365770000072], [55.616934281000056, 12.088619795000056], [55.61721836700008, 12.088727593000044], [55.61791335600003, 12.090461342000026], [55.61786770000003, 12.092446618000054]], [[55.61845614900005, 12.085520608000024], [55.61804017800006, 12.089275565000037], [55.61764956600007, 12.089176751000025], [55.61637624700006, 12.085906883000064], [55.61573196300003, 12.085942816000056], [55.614935470000034, 12.085493658000075], [55.61488981100007, 12.085987731000046], [55.614565121000055, 12.086068580000074], [55.61419476800006, 12.085969765000073], [55.614600634000055, 12.082556167000064], [55.615270303000045, 12.082879561000027], [55.61524493700006, 12.082879561000027], [55.61688355100006, 12.083346685000038], [55.61682774800005, 12.084451612000066], [55.61749737900004, 12.084658225000055], [55.61758869100004, 12.084047370000064], [55.618238018000056, 12.084289916000046], [55.61813148900006, 12.085430776000067], [55.61845614900005, 12.085520608000024]], [[55.62084536400005, 12.086805198000036], [55.62021637000004, 12.08693994600003], [55.62019608000003, 12.088269452000077], [55.61895835300004, 12.088547930000061], [55.61888226200006, 12.087460969000063], [55.61870978800005, 12.087478935000036], [55.61867935200007, 12.086670451000032], [55.62082000100003, 12.086131462000026], [55.62081492900006, 12.08614044500007], [55.62084536400005, 12.086805198000036]], [[55.619922160000044, 12.088547930000061], [55.61995766800004, 12.089760656000067], [55.619810563000044, 12.089787605000026], [55.619901870000035, 12.091341691000025], [55.61935909700003, 12.09143152200005], [55.619328661000054, 12.091790848000073], [55.619024298000056, 12.09157525300003], [55.61900908000007, 12.091440505000037], [55.618638770000075, 12.091512370000032], [55.61826845500008, 12.090605072000074], [55.61826845500008, 12.090353544000038], [55.61871993400007, 12.090182864000042], [55.618638770000075, 12.088817425000059], [55.619922160000044, 12.088547930000061]], [[55.61715749200005, 12.10329826700007], [55.61471224600007, 12.103684543000043], [55.615331182000034, 12.097899392000045], [55.61616317800008, 12.096902262000071], [55.61731982600003, 12.096776498000054], [55.61734011800007, 12.097611931000074], [55.61689369700008, 12.099103135000064], [55.61700530300004, 12.100845866000043], [55.61836991200005, 12.100657220000073], [55.61847136800003, 12.103091654000025], [55.619095317000074, 12.10299284000007], [55.61917648000008, 12.105319476000034], [55.61725895100005, 12.105624904000024], [55.61715749200005, 12.10329826700007]], [[55.61432667500003, 12.083517364000045], [55.61406793400005, 12.083975505000069], [55.61364176900008, 12.083661095000025], [55.613520007000034, 12.083741943000064], [55.613098910000076, 12.083050240000034], [55.61310905700003, 12.082529218000047], [55.613205453000035, 12.08203514400003], [55.61379397200005, 12.082178875000068], [55.61386499900004, 12.081684801000051], [55.613875146000055, 12.081693784000038], [55.613880219000066, 12.081693784000038], [55.613875146000055, 12.081684801000051], [55.61420998800003, 12.081783616000052], [55.61417447500003, 12.08221480700007], [55.61443828800003, 12.082601083000043], [55.61432667500003, 12.083517364000045]], [[55.61402734700005, 12.080867334000061], [55.61367221000006, 12.081307509000055], [55.61346419900008, 12.081388357000037], [55.61263214600007, 12.080948183000032], [55.61267780800006, 12.080220547000067], [55.61340331800005, 12.080292413000052], [55.61375338400006, 12.080121733000055], [55.61375845800006, 12.080121733000055], [55.61375338400006, 12.080130716000042], [55.61402734700005, 12.080867334000061]]];

    loads_of_polygons.forEach(function(poly) {
        L.polygon(poly).addTo(map);
    });
    //var polygon = L.polygon([[55.62387352200005, 12.068865842000037], [55.62319385500007, 12.068641263000075], [55.62322936100003, 12.065757671000028], [55.62427928800008, 12.066027166000026], [55.62387352200005, 12.068865842000037]]).addTo(map);


    var offset = 0;
    var heat;


    $( "#start-btn" ).click(function() {
        setInterval(function() {
            $.ajax({
                url: "/api/heatmap?offset=" + offset,
                method: 'GET'
            })
            .done(function( data ) {
                console.log(data);
    /*
                data.data.points.forEach(function(point) {
                    tiles.clear();
                    heat.addLatLng(L.latLng(point[0], point[1]));

                });
                */
                /*
                if(typeof heat !== typeof undefined ? true : false) {
                    map.removeLayer(heat);


                }
                */

            if(typeof markers !== typeof undefined ? true : false){
                map.removeLayer(markers);
            }

            $('#timestamp').text(data.data.start + ' - ' + data.data.end);

            var markers = new L.FeatureGroup();
            map.addLayer(markers);


            data.data.points.forEach(function(entry){
               markers.addLayer(L.marker([entry[0], entry[1]]));
            });



            /*
            points = data.data.points.map(function (p) {
                return [p[0], p[1]];
            });
            heat = L.heatLayer(points).addTo(map);
            */

            draw = true;
            //heat.redraw();

                //setTimeout(function(){ map.removeLayer(heat);}, 400);

            });

            offset++;



        }, 10000);
    });


</script>
</body>
</html>